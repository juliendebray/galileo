<%= content_for :title do %>
  <%= "#{@experience.name} : que faire, où dormir, bon plans et conseils de voyageurs" %>
<% end %>
<%= content_for (:description) do %>
  <%= @experience.description %>
<% end %>

<div class="wrapper" itemprop="itemReviewed" itemscope itemtype="http://schema.org/Thing">
  <div class="container-fluid" id="exp-page-container-fluid">
    <div class="experience-page">
      <div id="carousel-exp-page" class="carousel slide">
        <ol class="carousel-indicators">
          <li data-target="#carousel-exp-page" data-slide-to="0" class="active"></li>
          <% if @experience.experience_pictures.second %>
            <li data-target="#carousel-exp-page" data-slide-to="1"></li>
          <% end %>
          <% if @experience.experience_pictures.third %>
            <li data-target="#carousel-exp-page" data-slide-to="2"></li>
          <% end %>
          <% if @experience.experience_pictures.fourth %>
            <li data-target="#carousel-exp-page" data-slide-to="3"></li>
          <% end %>
        </ol>
        <div class="carousel-inner" role="listbox">
          <% @experience.experience_pictures.each_with_index do |experience_picture, index| %>
            <div class="item <%= 'active' if index == 0 %>" >
            <%= image_tag experience_picture.picture.url(:banner) %>
          </div>
          <% end %>
        </div>
        <a class="left carousel-control" href="#carousel-exp-page" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#carousel-exp-page" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
        <div class="experience-name text-center">
          <h1 itemprop="name"><%= @experience.name %></h1>
        </div>
      </div>
      <div class="vertical-spacer-xs"></div>
      <h4 class="text-center">A propos de cette attraction</h4>
      <div class="row text-center">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
          <% if @experience.onesentence %>
            <br>
            <em class="font-size-23">" <%= @experience.onesentence %> "</em>
            <br>
          <% end %>
          <p itemprop="description"><%= simple_format @experience.description %></p>
        </div>
      </div>
      <div class="experience-details">
        <div class="row text-center">
                <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
                  <div id="block-separator">
                  </div>
                </div>
              </div>
              <h4 class='text-center'>En bref</h4>
              <div class="vertical-spacer-xs"></div>
        <div class="container">
          <div class="row text-center">

              <% if @experience.good_points%>
                <div class="col-xs-6">
                  <br>
                  <i class="fa fa-thumbs-o-up"></i><b>&nbsp Ce qu'on aime</b> :  <p><%= @experience.good_points %></p>
                </div>
              <% end %>
              <% if @experience.bad_points%>
                <div class="col-xs-6">
                  <br>
                  <i class="fa fa-thumbs-o-down"></i><b>&nbsp Ce qu'on aime moins</b> :  <p><%= @experience.bad_points %></p>
                </div>
              <% end %>
              <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
                <% if @experience.timetospent.length > 0 %>
                  <br>
                  <br>
                    <i class="fa fa-clock-o"></i><b>&nbsp Temps de visite conseillé</b> :  <p><%= @experience.timetospent %></p>
                <% end %>
                <% if @experience.wheretosleep.length > 0 %>
                    <br>
                    <i class="fa fa-home"></i><b>&nbsp Où dormir</b> :  <p><%= @experience.wheretosleep %></p>
                <% end %>
                <% if @experience.transportation.length > 0 %>
                    <br>
                    <i class="fa fa-bicycle"></i><b>&nbsp Comment s'y rendre</b> : <p><%= @experience.transportation %></p>
                <% end %>
              </div>
          </div>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
          <% if @experience.unesco %>
            <div class="vertical-spacer-xs"></div>
            <p>Classé au <a href="http://whc.unesco.org/fr/list/" target="_blank">Patrimoine mondial de l'UNESCO</a></p>
          <% end %>
        </div>
      </div>
      <div class="vertical-spacer-xs"></div>
      <div class="row text-center">
        <div class="col-xs-12 col-sm-4 col-sm-offset-4">
          <div class="col-xs-4">
            <div class="fb-share-button" data-href="http://www.explorizers.com/experiences/<%= "#{@experience.id}" %>" data-layout="button">
            </div>
          </div>
          <div class="col-xs-4">
            <div class="pinterest-widget">
            <a href="//fr.pinterest.com/pin/create/button/" data-pin-do="buttonBookmark"  data-pin-color="red"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_red_28.png" /></a>
            </div>
          </div>
          <div class="col-xs-4">
            <a href="www.explorizers.com/experience/<%= "#{@experience.id}" %>" class="twitter-share-button" data-via="Explorizers_" data-count="none">Tweet</a>
          </div>
        </div>
        <div id="adsense" style='height:100px; width:100%;'>
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <!-- Experience#show -->
          <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7298325377656569"
          data-ad-slot="5217473533"
          data-ad-format="auto"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
          <div id="leader_review_block">
            <% if @experience.leader_reviews.any? %>
              <div class="row text-center">
                <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
                  <div id="block-separator">
                  </div>
                </div>
              </div>
              <h4>L'avis des experts</h4>
              <div class="vertical-spacer-xs"></div>
              <% if @experience.leader_reviews.first != @experience.leader_reviews.last %>
                <div class="row text-center">
                  <div class="col-xs-5 vcenter">
                    <div class="logo-item text-center">
                      <%= image_tag('lp_logo.png', alt:'Lonely Planet Logo Officiel') %>
                    </div>
                  </div>
                  <div class="col-xs-5 vcenter">
                    <div class="logo-item text-center">
                      <%= image_tag('gdr_logo.png', alt:'Le Guide du Routard Logo Officiel') %>
                    </div>
                  </div>
                </div>
                <br>
                <div class="row text-center">
                  <div class="col-xs-5 vcenter">
                    <% if @experience.leader_reviews.first.source =~ /Lonely Planet/ %>
                      <p>"<%= @experience.leader_reviews.first.comment %>"</p>
                    <% else %>
                      <p>"<%= @experience.leader_reviews.second.comment %>"</p>
                    <% end %>
                  </div>
                  <div class="col-xs-5 vcenter">
                    <% if @experience.leader_reviews.first.source =~ /Lonely Planet/ %>
                      <p>"<%= @experience.leader_reviews.second.comment %>"</p>
                    <% else %>
                      <p>"<%= @experience.leader_reviews.first.comment %>"</p>
                    <% end %>
                  </div>
                </div>
              <% else %>
                <div class="row text-center">
                  <div class="col-xs-12 vcenter">
                    <div class="logo-item text-center">
                      <% if @experience.leader_reviews.first.source =~ /Guide du Routard/ %>
                        <%= image_tag('gdr_logo.png', alt:'Le Guide du Routard Logo Officiel') %>
                      <% else %>
                        <%= image_tag('lp_logo.png', alt:'Lonely Planet Logo Officiel') %>
                      <% end %>
                    </div>
                  </div>
                </div>
                <br>
                <div class="row text-center">
                  <div class="col-xs-12 vcenter">
                    <p>"<%= @experience.leader_reviews.first.comment %>"</p>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
          <div class="row text-center">
            <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
              <div id="block-separator">
              </div>
            </div>
          </div>
          <div id="exp_review_block">
            <div class="row text-center">
              <h4>L'avis des voyageurs</h4>
            </div>
            <div class="vertical-spacer-xxs"></div>
            <div class="row text-center">
              <small><i>powered by</i></small>
            </div>
            <div class="row text-center">
              <%= image_tag('ta_logo.png', alt:'Tripadvisor Logo Officiel') %>
            </div>
            <div class="vertical-spacer-xs"></div>
            <div class="row text-center" itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
              <p>
                Note moyenne : <b><span itemprop="ratingValue"><%= @experience.average_rating %></span></b>/<span itemprop="bestRating">10</span>
                <% if @experience.ta_votes %>
                  <em> (<span itemprop="ratingCount"><%=@experience.ta_votes%></span> votes) </em>
                <% else %>
                <em> (<span itemprop="ratingCount">132</span> votes) </em>
                <% end %>
              </p>
            </div>
            <% if @experience.experience_reviews.any? %>
              <div class="vertical-spacer-xs"></div>
              <% @experience.experience_reviews.each do |experience_review| %>
                <blockquote>
                  <p>"<%= experience_review.comment %>"</p>
                  <footer><cite title="Source Title"><%= "#{experience_review.name} le #{experience_review.created_at.strftime("%d/%m/%y")} (note: #{experience_review.rating} / 5)" %></cite></footer>
                </blockquote>
              <% end %>
              <% if @experience.ta_url %>
                <%= link_to @experience.ta_url, target:'_blank', onclick:"ga('send', 'event', 'Reviews link', '#{experience.name}', 'Click on more reviews link from experience show');" do %>
                  <h5 class="text-center">Voir plus de commentaires </h5>
                <% end %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
          <div id="block-separator">
          </div>
        </div>
      </div>
      <h4 class="text-center">Localisation de l'attraction</h4>
      <div id="attraction-map">
      </div>
      <% if @near_experiences.any? %>
        <div class="row text-center">
          <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
            <div id="block-separator"></div>
          </div>
        </div>
        <div class="row text-center">
          <h4>Voir les attractions à proximité</h4>
          <div class="row">
          <% @near_experiences.each do |experience| %>
            <div class="col-xs-12 col-sm-6 col-md-4">
              <div class="experience-box">
                <%= link_to experience_path(experience.id), target: "_blank" do %>
                  <div class="experience-picture text-center">
                    <% if experience.experience_pictures.first %>
                      <%= image_tag experience.experience_pictures.first.picture.url(:medium), class: "img-responsive" %>
                    <% else %>
                      <%= image_tag 'https://s3-eu-west-1.amazonaws.com/philae-floju/photos_usa/usa_glacier_park_1.jpg' %>
                    <% end %>
                  </div>
                  <div class="experience-name text-center">
                    <small><%= experience.name %></small><br>
                  </div>
                <% end %>
              </div>
            </div>

        <% end %>
        </div>
        <br>
        <div class="row text-center">
          <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
            <div id="block-separator"></div>
          </div>
        </div>
      <% else %>
        <div class="row text-center">
          <%= link_to "Voir d'autres expériences", experiences_path, {class: "btn btn-info"} %>
        </div>
      <% end %>
       <div class="row text-center">
          <br>
          <% if @experience.destination %>
            <%= link_to "Voir la destination - #{@experience.destination.name.capitalize}", destination_path(@experience.destination), {class: "btn btn-info"} %>
            <% end %>
        </div>
      <div class="vertical-spacer-sm"></div>
    </div>
  </div>
</div>
<%= render partial: 'shared/footer' %>
<%= content_for(:before_js) do %>
  <%= javascript_include_tag "https://maps.google.com/maps/api/js?sensor=false&libraries=places&amp;key=AIzaSyCf77HD5LQkLbAcZWkBXKj-DLkXQJ9vHEc" %>
  <%= javascript_include_tag "https://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"%>
<% end %>
<% content_for(:after_js) do %>
  <script>
    $(document).on('ready', function() {
        var mapOptionsAttraction = {
          center: new google.maps.LatLng(<%= @experience.latitude %>, <%= @experience.longitude %>),
          zoom: 10,
          scrollwheel: false,
          scaleControl: true,
          panControl: false,
          disableDefaultUI: false,
          zoomControl: true,
          zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL
          }
        };
        handler = Gmaps.build('Google');
        handler.buildMap({ provider: mapOptionsAttraction, internal: { id: 'attraction-map' } }, function(){
          markers = handler.addMarkers([
              { "lat": <%= @experience.latitude %>, "lng": <%= @experience.longitude %>, "infowindow": "<%= @experience.name %>", "title": "Localisation de l'attraction" },
            ]);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
         handler.getMap().setZoom(10);
        });
      });
  </script>
<% end %>