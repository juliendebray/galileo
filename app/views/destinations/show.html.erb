<%= content_for :title do %>
  <%="#{@destination.name} : quels itinéraires, que faire, que voir, combien de temps"%>
<% end %>
<%= content_for (:description) do %>
  <%= "#{@destination.name} : toutes les informations dont vous avez besoin pour votre organiser votre voyage" %>
<% end %>
<body style="position=relative;" data-spy="scroll" data-target="#navbar-menu">
  <!-- Menu bar -->
  <div id="navbar-menu" role="navigation" class="hidden-xs">
    <ul class="nav nav-pills nav-justified" role="tablist">
      <li>
        <a href="#summary" onclick="ga('send', 'event', 'User', 'En bref Menu', 'User clicked on en bref from destination navbar menu');">En bref</a>
      </li>
      <li>
        <a href="#overview" onclick="ga('send', 'event', 'User', 'Must know Menu', 'User clicked on must know from destination navbar menu');">Infos pratiques</a>
      </li>
      <li>
        <a href="#must-see" onclick="ga('send', 'event', 'User', 'Attractions Menu', 'User clicked on attractions from destination navbar menu');">Les incontournables</a>
      </li>
      <li>
        <a href="#recommended-trip" onclick="ga('send', 'event', 'User', 'Itinerary Menu', 'User clicked on itinerary from destination navbar menu');">Les itinéraires</a>
      </li>
      <li>
        <a href="#accomodations" onclick="ga('send', 'event', 'User', 'My Trip Menu', 'User clicked on my trip from destination navbar menu');">Logements</a>
      </li>
      <li>
        <a href="#my-trip" onclick="ga('send', 'event', 'User', 'My Trip Menu', 'User clicked on my trip from destination navbar menu');">Plus de destinations</a>
      </li>
    </ul>
  </div>
  <!-- End of menu bar -->

<div class="black wrapper bg-white ">
  <div class="destination-banner" id="summary">
    <%= image_tag @destination.destination_pictures.first.picture.url(:banner) %>
    <h1 class='title-destination-page'>
      <%= @destination.name.capitalize %>
    </h1>
  </div>
  <div class="destination-content">
    <div class="destination-intro">
      <div class="row">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
          <h3 class="text-center">
            <%= @destination.intro_title %>
          </h3>
          <br>
          <p class="text-center">1</p>
          <p class="text-center"><%= raw @destination.sentence1 %></p>
          <div class="row text-center">
            <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
              <div class="block-separator"></div>
            </div>
          </div>
          <p class="text-center">2</p>
          <p class="text-center"><%= raw @destination.sentence2 %></p>
          <div class="row text-center">
            <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
              <div class="block-separator"></div>
            </div>
          </div>
          <p class="text-center">3</p>
          <p class="text-center"><%= raw @destination.sentence3 %></p>
          <div class="row text-center">
            <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
              <div class="block-separator"></div>
            </div>
          </div>
          <% if @destination.sentence4.length > 0 %>
            <p class="text-center">4</p>
            <p class="text-center"><%= raw @destination.sentence4 %></p>
            <div class="row text-center">
              <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
                <div class="block-separator"></div>
              </div>
            </div>
          <% end %>
          <% if @destination.sentence5.length > 0 %>
            <p class="text-center">5</p>
            <p class="text-center"><%= raw @destination.sentence5 %></p>
          <% end %>
          <br>
        </div>
      </div>
    </div>
  </div>
  <div class="vertical-spacer" id="overview"></div>
  <div class="destination-collapse">
    <div class="text-center">
      <%= image_tag @destination.destination_pictures.second.picture.url(:flat) %>
      <h2 class="no-margin title-destination-page">A savoir avant de partir</h2>
    </div>
  </div>
  <div>
    <div class="destination-content">
      <div class="things-to-know">
        <div class="row text-center">
          <small>Dernière mise à jour : <%= @destination.updated_at.strftime('%d-%m-%Y') %></small><br><br>
        </div>
        <div class="things-to-know">
          <div class="row">
            <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
              <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#visa" aria-expanded="false" aria-controls="visa">
                    <div class="panel-heading" role="tab" id="headingOne">
                      <h4 class="panel-title">
                        <p><%= raw @destination.enter_title %><i class="fa fa-angle-down"></i></p>
                      </h4>
                    </div>
                  </a>
                  <div id="visa" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                    <div class="panel-body">
                      <p><%= raw @destination.enter_line1 %></p>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#visit" aria-expanded="false" aria-controls="collapseTwo">
                    <div class="panel-heading" role="tab" id="headingTwo">
                      <h4 class="panel-title">
                        <p><%= raw @destination.visit_time_title %><i class="fa fa-angle-down"></i></p>
                      </h4>
                    </div>
                  </a>
                  <div id="visit" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                    <div class="panel-body">
                      <p><%= raw @destination.visit_line1 %></p>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#security" aria-expanded="false" aria-controls="collapseThree">
                    <div class="panel-heading" role="tab" id="headingThree">
                      <h4 class="panel-title">
                        <p><%= raw @destination.security_title %><i class="fa fa-angle-down"></i></p>
                      </h4>
                    </div>
                  </a>
                  <div id="security" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <div class="panel-body">
                      <p><%= raw @destination.security_line1 %></p>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#transport" aria-expanded="false" aria-controls="collapseFour">
                    <div class="panel-heading" role="tab" id="headingFour">
                      <h4 class="panel-title">
                        <p><%= raw @destination.transport_title %><i class="fa fa-angle-down"></i></p>
                      </h4>
                    </div>
                  </a>
                  <div id="transport" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                    <div class="panel-body">
                      <p><%= raw @destination.transport_line1 %></p>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#to-know" aria-expanded="true" aria-controls="collapseFive">
                    <div class="panel-heading" role="tab" id="headingFive">
                      <h4 class="panel-title">
                        <p><%= raw @destination.toknow_title %><i class="fa fa-angle-down"></i></p>
                      </h4>
                    </div>
                  </a>
                  <div id="to-know" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
                    <div class="panel-body">
                      <p><%= raw @destination.toknow_line1 %></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br><br>
  </div>
  <div class="vertical-spacer" id="must-see"></div>
  <div class="destination-collapse">
    <div class="text-center">
      <%= image_tag @destination.destination_pictures.third.picture.url(:flat) %>
      <h2 class="no-margin title-destination-page">Les incontournables</h2>
    </div>
  </div>
  <div>
  <br>
  <br>
    <div class="destination-content">
      <div class="container-fluid">
        <div class="row text-center">
          <ol>
            <% Experience.where(destination: @destination, published:true, must_see:true, landing_point:false).order(average_rating: :desc) {|experience| experience.average_rating }.each do |experience| %>
              <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                <%= link_to experience_path(experience.id), target: '_blank', onclick:"ga('send', 'event', 'User', 'Experience Detail from Que voir - incontournables', 'User clicks on experience #{experience.name} from explore_destination');" do %>
                  <div class="experience-name">
                    <li><p><%= experience.name %></p></li>
                  </div>
                <% end %>
                <div class="row text-center">
                  <div class="col-xs-12 col-sm-6">
                    <div class="experience-big-box">
                      <%= link_to experience_path(experience.id), target: '_blank', onclick:"ga('send', 'event', 'User', 'Experience Detail from Que voir - incontournables', 'User clicks on experience #{experience.name} from explore_destination');" do %>
                        <div class="experience-picture text-center">
                          <% if experience.experience_pictures.first %>
                            <%= image_tag experience.experience_pictures.first.picture.url(:medium), class: "img-responsive" %>
                          <% end %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <div class="experience-details">
                      <div class="experience-one-sentence">
                        <%= raw experience.onesentence %>
                      </div>
                      <div class="experience-category">
                        <% if experience.category_tab.any? %>
                          <% if experience.category_tab.include?('otbt') %>
                            <div class="experience-category-otbt text-center">
                              <p><i class="fa fa-compass"></i>Hors des sentiers battus</p>
                            </div>
                          <% end %>
                          <% if experience.category_tab.include?('nature') %>
                            <div class="experience-category-nature text-center">
                              <p><i class="fa fa-tree"></i>Nature</p>
                            </div>
                          <% end %>
                          <% if experience.category_tab.include?('culture') %>
                            <div class="experience-category-culture text-center">
                              <p><i class="fa fa-university"></i>Villes et culture</p>
                            </div>
                          <% end %>
                          <% if experience.category_tab.include?('sport') %>
                            <div class="experience-category-sport text-center">
                              <p><i class="fa fa-bicycle"></i>Sport</p>
                            </div>
                          <% end %>
                          <% if experience.category_tab.include?('relax') %>
                            <div class="experience-category-relax text-center">
                              <p><i class="fa fa-sun-o"></i>Détente</p>
                            </div>
                          <% end %>
                        <% end %>
                      </div>
                      <div class="experience-good-bad-points text-center">
                        <div class="table-responsive">
                          <table>
                            <% if experience.good_points && experience.good_points.length > 0 %>
                              <tr>
                                <td>
                                  <i class="fa fa-plus-circle"></i>
                                </td>
                                <td>
                                  <p><%= simple_format experience.good_points %></p>
                                </td>
                              </tr>
                            <% end %>
                            <% if experience.bad_points && experience.bad_points.length > 0 %>
                              <tr>
                                <td>
                                  <i class="fa fa-minus-circle"></i>
                                </td>
                                <td>
                                  <p><%= simple_format experience.bad_points %></p>
                                </td>
                              </tr>
                            <% end %>
                          </table>
                        </div>
                      </div>
                      <div class="experience-description">
                        <%= simple_format truncate(experience.description, length: 200, separator: ' ') %>
                      </div>
                      <div class="experience-know-more">
                        <p><%= link_to "En savoir plus", experience_path(experience.id), target: '_blank', onclick:"ga('send', 'event', 'User', 'Experience Detail from Que voir - incontournables', 'User clicks on experience #{experience.name} from explore_destination');" %></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </ol>
        </div>
        <br>
        <div class="row text-center">
          <%= link_to inspiration_trip_path(Trip.where(country_code: @destination.country_code).last), target: '_blank' do %>
            <h3>Consulter l'ensemble des activités à faire sur place <i class="fa fa-angle-right"></i></h3><br>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="vertical-spacer" id="recommended-trip"></div>
  <div class="destination-collapse" >
    <div class="text-center destination-title">
      <%= image_tag @destination.destination_pictures.fourth.picture.url(:flat) %>
      <h2 class="no-margin title-destination-page">Les itinéraires</h2>
    </div>
  </div>
  <div>
    <div class="destination-content">
      <div class="row">
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-10 col-md-offset-1">
          <div class="destination-itineraries">
              <div class="panel-group" id="accordion">
                <% RecommendedTrip.where(destination_id: @destination.id).sort_by {|rc| rc.id }.each_with_index do |rec_trip, index| %>
                  <div class="panel">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <%= link_to recommended_trip_path(rec_trip), target: '_blank' do %>
                          <div class="row">
                            <div class="col-xs-12 col-sm-3">
                              <%= link_to recommended_trip_path(rec_trip), target: '_blank' do %>
                                <div class="itinerary_image text-center">
                                  <%= image_tag rec_trip.picture.url(:banner) %>
                                </div>
                              <% end %>
                            </div>
                            <div class="col-xs-12 col-sm-6">
                              <a data-toggle="collapse" data-parent="#accordion" href="#collapse<%= index+1 %>">
                                <div class="itinerary-title">
                                  <p><%= raw rec_trip.title %></p>
                                </div>
                                <div class="rec-trip-duration">
                                  <% if rec_trip.duration && rec_trip.duration.length > 0 %>
                                    <p>durée : <b><%= raw rec_trip.duration %></b></p>
                                  <% end %>
                                </div>
                                <div class="rec-trip-suggested-by">
                                  <% if rec_trip.suggested_by %>
                                    <% if rec_trip.suggested_by.include?('Explorizers') %>
                                      <%= image_tag 'https://s3-eu-west-1.amazonaws.com/philae-floju/users/Explorizers.png' %>
                                    <% elsif rec_trip.suggested_by.include?('Charlotte') %>
                                      <%= image_tag 'https://s3-eu-west-1.amazonaws.com/philae-floju/users/Charlotte.png' %>
                                    <% elsif rec_trip.suggested_by.include?('Aurelia') %>
                                      <%= image_tag 'https://s3-eu-west-1.amazonaws.com/philae-floju/users/Aurelia.png' %>
                                    <% end %>
                                    <p><i>Créé par </i><%= raw rec_trip.suggested_by %></p>
                                  <% end %>
                                </div>
                              </a>
                            </div>
                          </div>
                        <% end %>
                      </h4>
                    </div>
                    <div id="collapse<%= index+1 %>" class="panel-collapse collapse">
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-xs-12 rec-trip-info">
                            <div class="row">
                              <div class="col-xs-12 col-sm-3">
                                <div class="itinerary-good-points text-center">
                                  <% if rec_trip.good_points && rec_trip.good_points.length > 0 %>
                                    <i class="fa fa-plus-circle"></i>
                                    <p><%= simple_format rec_trip.good_points %></p>
                                  <% end %>
                                </div>
                              </div>
                              <div class="col-xs-12 col-sm-9">
                                <div class="rec-trip-description">
                                  <p><i>Descriptif</i></p>
                                  <p><%= raw rec_trip.description %></p>
                                  <%= link_to 'Voir plus', recommended_trip_path(rec_trip), target: '_blank' %>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <div class="row text-center">
              <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
                <div class="block-separator"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
      <div id="block-separator"></div>
    </div>
  </div>
  <div class="vertical-spacer" id="accomodations"> </div>
  <div>
    <h4 class='text-center map-title'>Consultez les logements sur place</h4>
    <br>
    <div class="row">
      <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3">
        <div class="vertical-spacer-sm"></div>
        <div class="accomodations-booking text-center">
          <div class="vertical-spacer-xs"></div>
          <strong class="font-size-23">Meilleurs prix garantis. Annulation facile.</strong>
          <div class="vertical-spacer-xs"></div>
          <a href='<%="http://www.booking.com/country/#{@destination.country_code.downcase}.fr.html?aid=845697" %>' target='_blank' class="btn btn-info">Consultez les logements</a>
          <div class="vertical-spacer-xs"></div>
          <div><em>powered by</em></div>
          <div class="vertical-spacer-xxs"></div>
          <%= image_tag 'booking_logo.png' %>
          <div class="vertical-spacer-xxs"></div>
        </div>
      </div>
    </div>

  <div class="row">
    <div class="col-xs-4 col-xs-offset-4 col-sm-2 col-sm-offset-5">
      <div id="block-separator"></div>
    </div>
  </div>
  <div class="vertical-spacer" id="my-trip"> </div>
  <div>
    <h4 class='text-center map-title'>Découvrez nos autres destinations</h4>
    <br>
    <%= render partial: 'shared/destinations', locals: {destinations: Destination.all} %>
  </div>
  <div class="vertical-spacer-xs"></div>
  <%= render partial: 'shared/footer' %>
</body>


<%= content_for(:before_js) do %>
  <%= javascript_include_tag "https://maps.google.com/maps/api/js?sensor=false&libraries=places&amp;key=AIzaSyCf77HD5LQkLbAcZWkBXKj-DLkXQJ9vHEc" %>
  <%= javascript_include_tag "https://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"%>
  <%= javascript_include_tag "//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js" %>
<% end %>
<% content_for(:after_js) do %>
  <script>
    $(document).on('ready', function() {
      var mapOptions = {
        center: new google.maps.LatLng(0, 0),
        scrollwheel: false,
        zoom: 1,
        disableDoubleClickZoom: false,
        panControl: false,
        zoomControl: true,
        zoomControlOptions: {
          style: google.maps.ZoomControlStyle.SMALL
        }
      };
      handler = Gmaps.build('Google', { markers: { maxRandomDistance: 5, clusterer: undefined } });
      handler.buildMap({provider: mapOptions, internal: {id: 'map-container-destination'}}, function(){
        markers = handler.addMarkers(<%= raw @markers.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        setExperienceInfowindowForGlobalMap(<%= raw @markers.to_json %>);
      });
    });
  </script>
<% end %>